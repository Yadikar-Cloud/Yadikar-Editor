tinymce.PluginManager.add("cloudsignin",function(o,n){async function e(o){try{const n=await fetch(window.cloudProviders[o].tokenUrl),e=await n.json();return window.cloudProviders[o].authenticated=e.authenticated||!1,window.cloudProviders[o].token=e.token||null,window.cloudProviders[o].apiKey=e.api_key||null,e.authenticated}catch(o){return console.error("Error checking authentication:",o),!1}}function t(n,e){const t=window.cloudProviders[n],i={title:"Sign In Required",body:{type:"panel",items:[{type:"htmlpanel",html:`\n                            <div style="text-align: center; padding: 20px;">\n                                <div style="font-size: 48px; margin-bottom: 20px;">\n                                    ${t.icon}\n                                </div>\n                                <h3 style="margin-bottom: 10px;">Sign in to ${t.name}</h3>\n                                <p style="color: #666; margin-bottom: 20px;">\n                                    You need to sign in to access your ${t.name} files.\n                                </p>\n                            </div>\n                        `}]},buttons:[{type:"cancel",text:"Cancel"},{type:"custom",text:"Sign In with "+t.name,name:"signin",primary:!0}],onAction:function(t,i){"signin"===i.name&&(t.close(),function(n,e){const t=window.cloudProviders[n];window.pendingAuthCallback=e;const i=(screen.width-600)/2,a=(screen.height-700)/2;window.open(t.authUrl,"CloudAuth",`width=600,height=700,left=${i},top=${a},toolbar=no,location=no,status=no,menubar=no,scrollbars=yes,resizable=yes`)||o.notificationManager.open({text:"Popup blocked! Please allow popups for this site.",type:"error",timeout:5e3})}(n,e))}};o.windowManager.open(i)}return window.cloudProviders={google:{name:"Google Drive",icon:"üìÅ",authUrl:"/auth/google",tokenUrl:"/api/google/token",logoutUrl:"/auth/google/logout",authenticated:!1,token:null},dropbox:{name:"Dropbox",icon:"üì¶",authUrl:"/auth/dropbox",tokenUrl:"/api/dropbox/token",logoutUrl:"/auth/dropbox/logout",authenticated:!1,token:null},onedrive:{name:"OneDrive",icon:"‚òÅÔ∏è",authUrl:"/auth/onedrive",tokenUrl:"/api/onedrive/token",logoutUrl:"/auth/onedrive/logout",authenticated:!1,token:null}},window.addEventListener("message",async function(n){"google-auth-success"===n.data.type?(o.notificationManager.open({text:"Successfully signed in to Google Drive!",type:"success",timeout:3e3}),await e("google"),window.pendingAuthCallback&&(window.pendingAuthCallback(window.cloudProviders.google),window.pendingAuthCallback=null)):"google-auth-error"===n.data.type&&o.notificationManager.open({text:"Authentication failed: "+n.data.error,type:"error",timeout:5e3})}),window.requireCloudAuth=async function(o,n){return await e(o)?(n&&n(window.cloudProviders[o]),!0):(t(o,n),!1)},o.ui.registry.addButton("googlesignin",{text:"Google Drive",icon:"browse",onAction:async function(){if(await e("google")){confirm("You are signed in to Google Drive. Sign out?")&&(window.location.href=window.cloudProviders.google.logoutUrl)}else t("google")}}),o.on("init",async function(){await e("google")}),{getMetadata:function(){return{name:"Cloud Sign-In Manager",url:"http://yoursite.com"}}}});