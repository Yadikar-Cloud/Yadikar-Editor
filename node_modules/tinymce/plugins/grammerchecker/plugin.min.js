/**
 * Copyright (c) Tiny Technologies, Inc. All rights reserved.
 * Licensed under the LGPL or a commercial license.
 * For LGPL see License.txt in the project root for license information.
 * For commercial licenses see https://www.tiny.cloud/
 *
 * Version: 5.10.9 (2023-11-15)
 */
!function(){"use strict";var e=function(e){var t=e;return{get:function(){return t},set:function(e){t=e}}},t=tinymce.util.Tools.resolve("tinymce.PluginManager"),n=Object.hasOwnProperty,r=function(e){for(var t in e)if(n.call(e,t))return!1;return!0},o=tinymce.util.Tools.resolve("tinymce.util.Tools"),a=tinymce.util.Tools.resolve("tinymce.util.URI");tinymce.util.Tools.resolve("tinymce.util.XHR");var i=function(e){var t=e.getParam("language","en");return e.getParam("grammerchecker_language",t)},c=function(e){return e.getParam("grammerchecker_rpc_url")},s=function(e){var t=RegExp('[^\\s!"#$%&()*+,-./:;<=>?@[\\]^_{|}`\xa7\xa9\xab\xae\xb1\xb6\xb7\xb8\xbb\xbc\xbd\xbe\xbf\xd7\xf7\xa4”“„\xa0   ]+',"g");return e.getParam("grammerchecker_wordchar_pattern",t)},u=function(e){return e&&1===e.nodeType&&"false"===e.contentEditable},l=function(e,t){var n,r=[],o=t.dom,a=t.schema.getBlockElements(),i=t.schema.getWhiteSpaceElements(),c=t.schema.getShortEndedElements(),s=function(e,t){if(!e[0])throw Error("findAndReplaceDOMText cannot handle zero-length matches");return{start:e.index,end:e.index+e[0].length,text:e[0],data:t}},l=function(e){if(3===e.nodeType)return e.data;if(i[e.nodeName]&&!a[e.nodeName])return"";if(u(e))return"\n";var t="";if((a[e.nodeName]||c[e.nodeName])&&(t+="\n"),e=e.firstChild)do t+=l(e);while(e=e.nextSibling);return t},d=function(e,t,n){var r,o,s,l,d,f=[],m=0,g=e,h=0;(t=t.slice(0)).sort(function(e,t){return e.start-t.start}),d=t.shift();out:for(;;){if((a[g.nodeName]||c[g.nodeName]||u(g))&&m++,3===g.nodeType&&(!o&&g.length+m>=d.end?(o=g,l=d.end-m):r&&f.push(g),!r&&g.length+m>d.start&&(r=g,s=d.start-m),m+=g.length),r&&o){if(g=n({startNode:r,startNodeIndex:s,endNode:o,endNodeIndex:l,innerNodes:f,match:d.text,matchIndex:h}),m-=o.length-l,r=null,o=null,f=[],d=t.shift(),h++,!d)break}else if((!i[g.nodeName]||a[g.nodeName])&&g.firstChild){if(!u(g)){g=g.firstChild;continue}}else if(g.nextSibling){g=g.nextSibling;continue}for(;;){if(g.nextSibling){g=g.nextSibling;break}if(g.parentNode!==e)g=g.parentNode;else break out}}},f=function(e){var t=function(t,n){var a=r[n];a.stencil||(a.stencil=e(a));var i=a.stencil.cloneNode(!1);return i.setAttribute("data-mce-index",""+n),t&&i.appendChild(o.doc.createTextNode(t)),i};return function(e){var n,r,a,i=e.startNode,c=e.endNode,s=e.matchIndex,u=o.doc;if(i===c){var l=i;a=l.parentNode,e.startNodeIndex>0&&(n=u.createTextNode(l.data.substring(0,e.startNodeIndex)),a.insertBefore(n,l));var d=t(e.match,s);return a.insertBefore(d,l),e.endNodeIndex<l.length&&(r=u.createTextNode(l.data.substring(e.endNodeIndex)),a.insertBefore(r,l)),l.parentNode.removeChild(l),d}n=u.createTextNode(i.data.substring(0,e.startNodeIndex)),r=u.createTextNode(c.data.substring(e.endNodeIndex));for(var f=t(i.data.substring(e.startNodeIndex),s),m=0,g=e.innerNodes.length;m<g;++m){var h=e.innerNodes[m],p=t(h.data,s);h.parentNode.replaceChild(p,h)}var v=t(c.data.substring(0,e.endNodeIndex),s);return(a=i.parentNode).insertBefore(n,i),a.insertBefore(f,i),a.removeChild(i),(a=c.parentNode).insertBefore(v,c),a.insertBefore(r,c),a.removeChild(c),v}},m=function(e){for(var t=e.parentNode;e.childNodes.length>0;)t.insertBefore(e.childNodes[0],e);t.removeChild(e)},g=function(t){var n=e.getElementsByTagName("*"),r=[];t="number"==typeof t?""+t:null;for(var o=0;o<n.length;o++){var a,i=n[o],c=i.getAttribute("data-mce-index");null!==c&&c.length&&-1!==(a=i).className.indexOf("mce-spellchecker-grammar")&&(c===t||null===t)&&r.push(i)}return r},h=function(e){for(var t=r.length;t--;)if(r[t]===e)return t;return -1};function p(e){for(var t=0,n=r.length;t<n&&!1!==e(r[t],t);t++);return this}function v(e){var t,n=g(e?h(e):null);for(t=n.length;t--;)m(n[t]);return this}var x=function(e){return r[e.getAttribute("data-mce-index")]},N=function(e){return g(h(e))[0]},k=function(e){var n=g(h(e)),r=t.dom.createRng();return r.setStartBefore(n[0]),r.setEndAfter(n[n.length-1]),r},b=function(e,n){var r=k(e);return r.deleteContents(),n.length>0&&r.insertNode(t.dom.doc.createTextNode(n)),r},y=l(e);return{text:y,matches:r,each:p,filter:function e(t){var n=[];return p(function(e,r){t(e,r)&&n.push(e)}),r=n,this},reset:function e(){return r.splice(0,r.length),v(),this},matchFromElement:x,elementFromMatch:N,find:function e(t,o){if(y&&t.global)for(;n=t.exec(y);)r.push(s(n,o));return this},add:function e(t,n,o){return r.push({start:t,end:t+n,text:y.substr(t,n),data:o}),this},wrap:function t(n){return r.length&&d(e,r,f(n)),this},unwrap:v,replace:b,rangeFromMatch:k,indexOf:h}},d=function(e,t){if(!t.get()){var n=l(e.getBody(),e);t.set(n)}return t.get()},f=function(e,t,n,r,o,i,s){var u,l,d,f,m;((u=e).getParam("grammerchecker_callback")||(l=e,d=t,function(e,t,n,r){let o=new a(d).toAbsolute(c(l)),i=new URLSearchParams({text:t,language:"auto"});fetch(o,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:i.toString()}).then(e=>{if(!e.ok)throw Error(`HTTP error! Status: ${e.status}`);return e.json()}).then(e=>{if(e)e.error?r(e.error):n(e);else{let t=l.translate("Server response wasn't proper JSON.");r(t)}}).catch(e=>{let t=l.translate("The spelling service was not found: (")+c(l)+l.translate(")");r(t)})})).call(e.plugins.grammerchecker,r,o,i,s)},m=function(e,t,n,r,o,a){if(!v(e,n,r)){var i=function(t){e.notificationManager.open({text:t,type:"error"}),e.setProgressState(!1),v(e,n,r)},c=function(t){k(e,n,r,o,t)};e.setProgressState(!0),f(e,t,a,"grammercheck",d(e,r).text,c,i),e.focus()}},g=function(e,t,n){e.dom.select("span.mce-spellchecker-grammar").length||v(e,t,n)},h=function(e,t,n,r,o,a,i){e.setProgressState(!0),f(e,t,o,"addToDictionary",a,function(){e.setProgressState(!1),e.dom.remove(i,!0),g(e,n,r)},function(t){e.notificationManager.open({text:t,type:"error"}),e.setProgressState(!1)})},p=function(e,t,n,r,a,i){e.selection.collapse(),i?o.each(e.dom.select("span.mce-spellchecker-grammar"),function(t){t.getAttribute("data-mce-word")===r&&e.dom.remove(t,!0)}):e.dom.remove(a,!0),g(e,t,n)},v=function(e,t,n){var r,o=e.selection.getBookmark();if(d(e,n).reset(),e.selection.moveToBookmark(o),n.set(null),t.get())return t.set(!1),(r=e).fire("GrammercheckEnd"),!0},x=function(e){var t=e.getAttribute("data-mce-index");return"number"==typeof t?""+t:t},N=function(e,t){var n=[],r=o.toArray(e.getBody().getElementsByTagName("span"));if(r.length)for(var a=0;a<r.length;a++){var i=x(r[a]);null!==i&&i.length&&i===t.toString()&&n.push(r[a])}return n},k=function(e,t,n,o,a){var i,c=!!a.dictionary,u=a.matches;if(e.setProgressState(!1),r(u)){var l=e.translate("No misspellings found.");e.notificationManager.open({text:l,type:"info"}),t.set(!1);return}var f=e.selection.getBookmark();let m={};d(e,n).find(s(e)).filter(function(e){return u.some(function(t){return t.offset===e.start})}).wrap(function(t){return u.forEach(e=>{e.offset===t.start&&(m[t.text]=e)}),e.dom.create("span",{class:"mce-spellchecker-grammar","aria-invalid":"spelling","data-mce-bogus":1,"data-mce-word":t.text})}),o.set({suggestions:m,hasDictionarySupport:c}),e.selection.moveToBookmark(f),t.set(!0),(i=e).fire("GrammercheckStart")},b=function(e,t,n,r,o){var a=function(){return s(e)},i=function(o){k(e,t,r,n,o)};return{getTextMatcher:r.get,getWordCharPattern:a,markErrors:i,getLanguage:o.get}},y=function(e,t,n,r,o,a){e.addCommand("mceGrammerCheck",function(){m(e,t,n,r,o,a)})},$=function(){return($=Object.assign||function e(t){for(var n,r=1,o=arguments.length;r<o;r++)for(var a in n=arguments[r])Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a]);return t}).apply(this,arguments)},S="GrammercheckStart GrammercheckEnd",T=function(e,t){var n=[];return o.each(t,function(e){n.push({selectable:!0,text:e.name,data:e.value})}),n},w=function(e){var t;return o.map((t=e).getParam("grammerchecker_languages","English=en,Danish=da,Dutch=nl,Finnish=fi,French=fr_FR,German=de,Italian=it,Polish=pl,Portuguese=pt_BR,Spanish=es,Swedish=sv").split(","),function(e){var t=e.split("=");return{name:t[0],value:t[1]}})},A=function(e,t,n,r,a,i){var c=T("Language",w(e)),s=function(){m(e,t,n,r,i,a)},u={tooltip:"Grammercheck",onAction:s,icon:"spell-check",onSetup:function(t){var r=function(){t.setActive(n.get())};return e.on(S,r),function(){e.off(S,r)}}},l=$($({},u),{type:"splitbutton",select:function(e){return e===a.get()},fetch:function(e){var t=o.map(c,function(e){return{type:"choiceitem",value:e.data,text:e.text}});e(t)},onItemAction:function(e,t){a.set(t)}});c.length>1?e.ui.registry.addSplitButton("grammerchecker",l):e.ui.registry.addToggleButton("grammerchecker",u),e.ui.registry.addToggleMenuItem("grammerchecker",{text:"Grammercheck",icon:"spell-check",onSetup:function(t){t.setActive(n.get());var r=function(){t.setActive(n.get())};return e.on(S,r),function(){e.off(S,r)}},onAction:s})},B=function(e,t,n,r,a,i,c,s){var u=[],l=n.get().suggestions[c];u.push.apply(u,[{text:l.message},{type:"separator"}]);let d=l.replacements.map(e=>e.value);return o.each(d,function(t){u.push({text:t,onAction:function(){e.insertContent(e.dom.encode(t)),e.dom.remove(s),g(e,r,a)}})}),n.get().hasDictionarySupport&&(u.push({type:"separator"}),u.push({text:"Add to dictionary",onAction:function(){h(e,t,r,a,i,c,s)}})),u.push.apply(u,[{type:"separator"},{text:"Ignore",onAction:function(){p(e,r,a,c,s)}},{text:"Ignore all",onAction:function(){p(e,r,a,c,s,!0)}}]),u},P=function(e,t,n,r,o,a){var i=function(i){var c=i;if("mce-spellchecker-grammar"!==c.className)return[];var s=N(e,x(c));if(s.length>0){var u=e.dom.createRng();return u.setStartBefore(s[0]),u.setEndAfter(s[s.length-1]),e.selection.setRng(u),B(e,t,n,r,o,a,c.getAttribute("data-mce-word"),s)}};e.ui.registry.addContextMenu("grammerchecker",{update:i})};t.add("grammerchecker",function(t,n){var r;if(!1==(!!(r=t).hasPlugin("tinymcegrammerchecker",!0)&&(void 0!==window.console&&window.console.log&&window.console.log("Grammer Checker Pro is incompatible with Grammer Checker plugin! Remove 'grammerchecker' from the 'plugins' option."),!0))){var o=e(!1),a=e(i(t)),c=e(null),s=e(null);return A(t,n,o,c,a,s),P(t,n,s,o,c,a),y(t,n,o,c,s,a),b(t,o,s,c,a)}})}();