tinymce.PluginManager.add("suggestions",function(e){const t=e.getParam("search_function",null),n=e.getParam("debounce_time",250),o=e.getParam("suggestion_text_color","#999999"),i=e.getParam("suggestion_node_id","suggestionNodeId"),a=e.getParam("min_search_length",3),s=e.getParam("terms_list",[]);let l,r,c=!1;const u=["Space","Enter","NumpadEnter","Delete","Escape"],g=["ShiftLeft","ShiftRight","AltRight","AltLeft","ControlLeft","ControlRight"];function f(){l&&l.remove(),l=void 0}function d(e){return-1==u.indexOf(e)}function L(e,t){f();let n=e.selection.getRng(1);l=e.getDoc().createElement("span"),l.style.color=o,l.innerHTML=t,l.id=i;e.selection.getSel().focusOffset;n.insertNode(l);let a=e.dom.select(`#${i}`);null!=a[0].lastChild&&e.selection.setCursorLocation(a[0].firstChild,0),e.selection.collapse(0),c=!0,r=t}function m(){c=!1,r=void 0}async function h(e){let n=e.selection.getSel().focusOffset,o=e.selection.getRng(1).startContainer.data;if(o){let i=o.substring(n);if(0==i.length||i.match(/^\s/g)){const n=function(e,t){let n=new RegExp(`${t}$`,"gi");return e.replace(n,"").split(" ").pop()}(o,i);if(n.length>=a){let o=await async function(e){if(null==t)return s.find(t=>t.toLocaleLowerCase().startsWith(e.toLocaleLowerCase()));{let n=await t(e);if(!n)return;return Array.isArray(n)?n.find(t=>t.toLocaleLowerCase().startsWith(e.toLocaleLowerCase())):n.toLocaleLowerCase().startsWith(e.toLocaleLowerCase())?n:void 0}}(n);if(null!=o){L(e,function(e,t){let n=new RegExp(`^${e}`,"gi");return t.replace(n,"")}(n,o))}}}}}let p=function(e,t=n){let o;return(...n)=>{clearTimeout(o),o=setTimeout(()=>{e(...n)},t)}}(async function(e,t){d(e.code)&&h(t);e.key,e.code});e.on("keyup",t=>{c||p(t,e)}),e.on("keydown",t=>{var n,o;"Tab"==t.code&&c?((o=t).stopPropagation(),o.preventDefault(),n=e,f(),n.execCommand("mceInsertContent",!1,r),n.selection.collapse(1),m()):d(t.code)?c&&-1==g.indexOf(t.code)&&function(e,t){r&&r.toLocaleLowerCase().startsWith(t.toLocaleLowerCase())?(r=r.substring(1),f(),L(e,r)):(f(),m())}(e,t.key):(f(),m())}),e.on("blur",e=>{f(),m()}),e.on("click",e=>{f(),m()})});