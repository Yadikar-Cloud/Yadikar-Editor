tinymce.PluginManager.add("chart",(function(t,e){var a,n,r,i=!1,o=400,l=300,s="",d="",c="",h="",u="",g="",p="",f="",y="",m="";function C(){var e=n.toBase64Image();1==i?t.insertContent('<img src="'+e+'" width="'+o+'" height="'+l+'"  alt="'+r+'" style="display:block;margin-left:auto;margin-right:auto;">'):t.insertContent('<img src="'+e+'" width="'+o+'" height="'+l+'"  alt="'+r+'">'),document.body.removeChild(a),t.setProgressState(!1),t.setMode("design")}function b(t){return Number(t)===t&&t%1==0}function x(t){return Number(t)===t&&t%1!=0}function v(t){for(var e=0;e<=t.length;e++){var a=t.charCodeAt(e);if(a<48||a>57)return!1}return!0}function A(){var e,s,A=t.selection.getNode(),S=A.alt,I="",M="0",T=o,F=l;if(i=!1,null!=S){try{I=(I=S).substring(I.indexOf("///")+3,I.length),e="---",s="\n",I=I.replace(new RegExp(e,"g"),s);var w=S.split("///")[0].split(","),E=w[0];E=E.substring(E.length-1,E.length);var k=w[1],B=w[2];b(parseInt(E))&&(M=E),(b(parseInt(k))||x(parseFloat(k)))&&(T=k),(b(parseInt(B))||x(parseFloat(B)))&&(F=B)}catch(t){}try{var _=A.style.display,D=A.style["margin-left"],N=A.style["margin-right"];"block"==_&&"auto"==D&&"auto"==N&&(i=!0)}catch(t){}}t.windowManager.open({title:d,body:{type:"panel",items:[{type:"selectbox",name:"chartType",label:c,items:[{text:h,value:"0"},{text:u,value:"1"},{text:g,value:"2"}]},{type:"input",name:"chartWidth",label:p},{type:"input",name:"chartHeight",label:f},{type:"checkbox",name:"chartCentered",label:y},{type:"label",label:m,items:[]},{type:"textarea",name:"chartcode",placeholder:""}]},buttons:[{type:"cancel",text:"Cancel"},{type:"submit",text:"Insert",primary:!0}],initialData:{chartType:M,chartWidth:String(T),chartHeight:String(F),chartCentered:i,chartcode:I},onSubmit:function(e){!function(e){var s=e.data.chartWidth,d=e.data.chartHeight;""!=s&&1==v(s)&&parseInt(s)>0&&(o=parseInt(s)),""!=d&&1==v(d)&&parseInt(d)>0&&(l=parseInt(d)),(a=document.createElement("canvas")).id="ChartJsTemp",a.width=o,a.height=l,a.style.display="none",document.body.appendChild(a);var c,h=[],u=[],g=[],p=e.data.chartType,f=e.data.chartcode;if(c="2"==p?[{backgroundColor:u,data:g,fill:!1,borderColor:"#3facee",pointBackgroundColor:"#3facee"}]:[{backgroundColor:u,data:g}],""!=f){var y=f.split("\n");r="chartTinyMCE"+p+","+o+","+l+"///";for(var m=0;m<y.length;m++){m>0&&(r+="---"),r+=y[m];var b=y[m].split(","),x=b[0],A=b[1],S=b[2];""!=x?h.push(x):h.push("-"),""!=A?g.push(A):g.push(0),"2"==p?u.push("#3facee"):""!=S?u.push(S):u.push("grey")}i=e.data.chartCentered,t.setProgressState(!0),t.setMode("readonly"),"0"==p?n=new Chart(document.getElementById("ChartJsTemp").getContext("2d"),{type:"bar",data:{labels:h,datasets:c},options:{layout:{padding:{left:15,right:0,top:25,bottom:0}},showDatapoints:!0,responsive:!1,maintainAspectRatio:!1,title:{display:!1},legend:{display:!1},scales:{xAxes:[{gridLines:{display:!1},ticks:{min:0}}],yAxes:[{gridLines:{display:!1},ticks:{min:0,precision:0}}]},animation:{onComplete:function(){var t=this.chart,e=t.ctx;e.font=Chart.helpers.fontString(Chart.defaults.global.defaultFontSize,Chart.defaults.global.defaultFontStyle,Chart.defaults.global.defaultFontFamily),e.textAlign="center",e.textBaseline="bottom",this.data.datasets.forEach((function(a,n){t.controller.getDatasetMeta(n).data.forEach((function(t,n){var r=a.data[n];e.fillText(r,t._model.x,t._model.y-5)}))})),C()}}}}):"1"==p?n=new Chart(document.getElementById("ChartJsTemp").getContext("2d"),{type:"pie",data:{labels:h,datasets:c},options:{layout:{padding:{left:0,right:0,top:0,bottom:0}},showDatapoints:!0,responsive:!1,maintainAspectRatio:!1,title:{display:!1},animation:{onComplete:function(){var t=this.chart.ctx;t.font=Chart.helpers.fontString(Chart.defaults.global.defaultFontSize,Chart.defaults.global.defaultFontStyle,Chart.defaults.global.defaultFontFamily),t.textAlign="center",t.textBaseline="bottom",this.data.datasets.forEach((function(e){for(var a=0;a<e.data.length;a++){var n=e._meta[Object.keys(e._meta)[0]].data[a]._model,r=e._meta[Object.keys(e._meta)[0]].total,i=n.innerRadius+(n.outerRadius-n.innerRadius)/2,o=n.startAngle,l=o+(n.endAngle-o)/2,s=i*Math.cos(l),d=i*Math.sin(l);t.fillStyle="#fff",3==a&&(t.fillStyle="#444");var c=e.data[a],h=String(Math.round(c/r*100))+"%";0!=c&&(t.fillText(e.data[a],n.x+s,n.y+d),t.fillText(h,n.x+s+2,n.y+d+15))}})),C()}}}}):"2"==p&&(n=new Chart(document.getElementById("ChartJsTemp").getContext("2d"),{type:"line",data:{labels:h,datasets:c},options:{layout:{padding:{left:15,right:20,top:25,bottom:0}},showDatapoints:!0,responsive:!1,maintainAspectRatio:!1,title:{display:!1},legend:{display:!1},scales:{xAxes:[{gridLines:{display:!1}}],yAxes:[{gridLines:{display:!1},ticks:{precision:0}}]},animation:{onComplete:function(){var t=this.chart,e=t.ctx;e.font=Chart.helpers.fontString(Chart.defaults.global.defaultFontSize,Chart.defaults.global.defaultFontStyle,Chart.defaults.global.defaultFontFamily),e.textAlign="center",e.fillStyle="gray",e.textBaseline="bottom",this.data.datasets.forEach((function(a,n){t.controller.getDatasetMeta(n).data.forEach((function(t,n){var r=a.data[n];e.fillText(r,t._model.x,t._model.y-5)}))})),C()}}}}))}}({data:e.getData()}),e.close()}})}return"es"==t.settings.language?(s="Gráfico",d="Insertar/editar gráfico",c="Tipo de gráfico",h="Barra",u="Torta",g="Línea",p="Ancho del gráfico",f="Alto del gráfico",y="Centrado",m="Ingrese el código del gráfico (cada línea es un registro, ejemplo: Marzo,10,blue)"):(s="Chart",d="Insert/edit chart",c="Chart type",h="Bar",u="Pie",g="Line",p="Chart Width",f="Chart Height",y="Centered",m="Input the chart code (each line is an entry, example: March,10,blue)"),t.ui.registry.addToggleButton("chart",{tooltip:d,icon:"chart",onAction:function(){A()},onSetup:function(e){var a=function(){try{var a=t.selection.getNode(),n=a.alt;"IMG"==a.nodeName&&n&&"chartTinyMCE"==n.substring(0,12)?e.setActive(!0):e.setActive(!1)}catch(t){e.setActive(!1)}};return t.on("NodeChange",a),a(),function(){t.off("NodeChange",a)}}}),t.ui.registry.addMenuItem("chart",{text:s,context:"insert",onAction:function(){A()}}),{getMetadata:function(){return{name:"Chart plugin",url:"https://lrusso.com.ar"}}}}));