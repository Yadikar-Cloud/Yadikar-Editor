tinymce.PluginManager.add("pdfImport",(function(t,e){var n=window["pdfjs-dist/build/pdf"];let a=[];async function o(t,e){try{const n=await Tesseract.createWorker("eng",1,{logger:t=>{if("recognizing text"===t.status){const n=Math.round(100*t.progress);e&&e.redial({title:"Scanning PDF with Tesseract OCR...",body:{type:"panel",items:[{type:"htmlpanel",html:`\n\t\t\t\t                                    <div style="padding: 10px;">\n\t\t\t\t                                        <label for="ocr-progress">OCR Progress: ${n}%</label>\n\t\t\t\t                                        <progress id="ocr-progress" max="100" value="${n}" style="width: 100%; height: 20px;"></progress>\n\t\t\t\t                                    </div>\n\t\t\t\t\t\t\t\t\t\t\t`}]},buttons:[]})}}}),a=await n.recognize(t);return await n.terminate(),a.data.text}catch(t){throw console.error("OCR Error:",t),t}}async function i(e){try{const r={title:"Loading PDF...",body:{type:"panel",items:[{type:"htmlpanel",html:"\n                            <p>Loading PDF in progress</p>\n                        "}]},buttons:[]};var a=t.windowManager.open(r);const s=n.getDocument({data:e}),l=await s.promise,c=l.numPages;var i="";for(let t=1;t<c+1;t++){const e=await l.getPage(t),n=Math.round(t/c*100);a.redial({title:"Scanning PDF with Tesseract OCR...",body:{type:"panel",items:[{type:"htmlpanel",html:`\n\t\t\t\t\t\t            <div style="padding: 10px;">\n\t\t\t\t\t\t                <label for="file-progress">File progress: ${n}%</label>\n\t\t\t\t\t\t                <progress id="file-progress" max="100" value="${n}" style="width: 100%; height: 20px;"></progress>\n\t\t\t\t\t\t                <p>Processing page ${t} of ${c}</p>\n\t\t\t\t\t\t            </div>\n\t\t                    `}]},buttons:[]});const r=1.5,s=e.getViewport({scale:r}),p=document.createElement("canvas"),d=p.getContext("2d");p.height=s.height,p.width=s.width;const g={canvasContext:d,viewport:s};await e.render(g).promise,i+=await o(p)}return a.close(),i}catch(t){throw console.error("Error processing PDF:",t),t}}async function r(t){var e="";const n={title:"Select a file",size:"normal",body:{type:"panel",items:[{type:"selectbox",name:"language",label:"File Language",items:a.map((t=>({text:t.name,value:t.code})))},{type:"urlinput",name:"file",label:"File Name",filetype:"file"}]},buttons:[{type:"cancel",text:"Cancel"},{type:"submit",text:"Confirm",primary:!0}],onSubmit:async function(n){const a=n.getData();processedFileData&&(console.log("File type:",processedFileData.type),console.log("File content:",processedFileData.content),console.log("Selected language:",a.language),-1!==processedFileData.type.indexOf("image")&&(e=await o(processedFileData.file,r),t.execCommand("pasteText",e)),-1!==processedFileData.type.indexOf("pdf")&&(e=await i(processedFileData.content),t.execCommand("pasteText",e)),processedFileData=null),n.close()}};var r=t.windowManager.open(n)}return t.ui.registry.addButton("pdfimport",{text:"Import PDF",icon:"export-pdf",onAction:function(){r(t)}}),t.ui.registry.addMenuItem("pdfimport",{text:"Import PDF",icon:"export-pdf",onAction:function(){r(t)}}),t.on("init",(function(){!async function(){try{const t=await fetch(e+"/languages.json");a=await t.json()}catch(t){console.error("Failed to load languages:",t),a=[{code:"en_US",name:"English (US)"},{code:"it",name:"Italian"},{code:"es",name:"Spanish"},{code:"fr_FR",name:"French"},{code:"de",name:"German"}]}}()})),{getMetadata:function(){return{name:"Open from Computer",url:"http://yoursite.com"}}}}));