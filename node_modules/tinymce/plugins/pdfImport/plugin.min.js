tinymce.PluginManager.add("pdfImport",(function(t,e){var n=window["pdfjs-dist/build/pdf"];let a=[];async function o(t,e,n){try{const a=await Tesseract.createWorker(e,1,{logger:t=>{if("recognizing text"===t.status){const e=Math.round(100*t.progress);n&&n.redial({title:"Scanning PDF with Tesseract OCR...",body:{type:"panel",items:[{type:"htmlpanel",html:`\n\t\t\t\t                                    <div style="padding: 10px;">\n\t\t\t\t                                        <label for="ocr-progress">OCR Progress: ${e}%</label>\n\t\t\t\t                                        <progress id="ocr-progress" max="100" value="${e}" style="width: 100%; height: 20px;"></progress>\n\t\t\t\t                                    </div>\n\t\t\t\t\t\t\t\t\t\t\t`}]},buttons:[]})}}}),o=await a.recognize(t);return await a.terminate(),o.data.text}catch(t){throw console.error("OCR Error:",t),t}}async function i(e,a){try{const s={title:"Loading PDF...",body:{type:"panel",items:[{type:"htmlpanel",html:"\n                            <p>Loading PDF in progress</p>\n                        "}]},buttons:[]};var i=t.windowManager.open(s);const l=n.getDocument({data:e}),c=await l.promise,p=c.numPages;var r="";for(let t=1;t<p+1;t++){const e=await c.getPage(t),n=Math.round(t/p*100);i.redial({title:"Scanning PDF with Tesseract OCR...",body:{type:"panel",items:[{type:"htmlpanel",html:`\n\t\t\t\t\t\t            <div style="padding: 10px;">\n\t\t\t\t\t\t                <label for="file-progress">File progress: ${n}%</label>\n\t\t\t\t\t\t                <progress id="file-progress" max="100" value="${n}" style="width: 100%; height: 20px;"></progress>\n\t\t\t\t\t\t                <p>Processing page ${t} of ${p}</p>\n\t\t\t\t\t\t            </div>\n\t\t                    `}]},buttons:[]});const s=1.5,l=e.getViewport({scale:s}),d=document.createElement("canvas"),g=d.getContext("2d");d.height=l.height,d.width=l.width;const m={canvasContext:g,viewport:l};await e.render(m).promise,r+=await o(d,a)}return i.close(),r}catch(t){throw console.error("Error processing PDF:",t),t}}async function r(t){var e="";const n={title:"Select a file",size:"normal",body:{type:"panel",items:[{type:"selectbox",name:"language",label:"File Language",items:a.map((t=>({text:t.name,value:t.code})))},{type:"urlinput",name:"file",label:"File Name",filetype:"file"}]},buttons:[{type:"cancel",text:"Cancel"},{type:"submit",text:"Confirm",primary:!0}],onSubmit:async function(n){const a=n.getData();processedFileData&&(-1!==processedFileData.type.indexOf("image")&&(e=await o(processedFileData.file,a.language,r),t.execCommand("pasteText",e)),-1!==processedFileData.type.indexOf("pdf")&&(e=await i(processedFileData.content,a.language),t.execCommand("pasteText",e)),processedFileData=null),n.close()}};var r=t.windowManager.open(n)}return t.ui.registry.addButton("pdfimport",{text:"Import PDF",icon:"importpdf",onAction:function(){r(t)}}),t.ui.registry.addMenuItem("pdfimport",{text:"Import PDF",icon:"importpdf",onAction:function(){r(t)}}),t.on("init",(function(){!async function(){try{const t=await fetch("editor/assets/ocr_languages.json");a=await t.json()}catch(t){console.error("Failed to load languages:",t),a=[{code:"en_US",name:"English (US)"},{code:"it",name:"Italian"},{code:"es",name:"Spanish"},{code:"fr_FR",name:"French"},{code:"de",name:"German"}]}}()})),{getMetadata:function(){return{name:"Open from Computer",url:"http://yoursite.com"}}}}));