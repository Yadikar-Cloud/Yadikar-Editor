tinymce.PluginManager.add("pdfImport",(function(e,t){let o=null;var n=window["pdfjs-dist/build/pdf"];async function r(){try{if(!window.showOpenFilePicker)return void e.notificationManager.open({text:"File System Access API is not supported in your browser. Please use Chrome, Edge, or Opera.",type:"error",timeout:5e3});const t={types:[{description:"PDF file",accept:{"application/pdf":[".pdf"]}},{description:"PNG file",accept:{"image/png":[".png"]}},{description:"JPEG file",accept:{"image/jpeg":[".jpeg"]}},{description:"WebP file",accept:{"image/webp":[".webp"]}},{description:"TIFF file",accept:{"image/tiff":[".tiff"]}}],multiple:!1,excludeAcceptAllOption:!0};return[o]=await window.showOpenFilePicker(t),await o.getFile()}catch(t){"AbortError"!==t.name&&(console.error("Error opening file:",t),e.notificationManager.open({text:"Failed to open file: "+t.message,type:"error",timeout:5e3}))}}async function i(e,t){try{const o=await Tesseract.createWorker("eng",1,{logger:e=>{if(console.log(e),"recognizing text"===e.status){const o=Math.round(100*e.progress);t.redial({title:"Importing PDF...",body:{type:"panel",items:[{type:"htmlpanel",html:`\n\t\t                                    <label for="file-progress">File progress:</label>\n\t\t                                    <progress id="file-progress" max="100" value="${o}">${o}%</progress>\n\t\t                                `}]},buttons:[]})}}}),n=await o.recognize(e);return console.log("result",n),await o.terminate(),n.data.text}catch(e){throw console.error("OCR Error:",e),e}}function a(t){e.setContent(t),setTimeout((()=>{window.reapplyPageView&&window.reapplyPageView(t)}),100)}async function s(e){var t=await r(),o="";const s={title:"Importing PDF...",size:"small",body:{type:"panel",items:[{type:"htmlpanel",html:'\n\t\t\t\t\t\t\t\t\t\t\t<label for="file">File progress:</label>\n\t\t\t\t\t\t\t\t\t\t\t<progress id="file" max="100" value="70">70%</progress>\t                \n\t\t                '}]},buttons:[]};var l=e.windowManager.open(s);if(-1!==t.type.indexOf("image")&&(o=await i(t,l),console.log("OCR Result:",o),a(o)),-1!==t.type.indexOf("pdf")){var c=new FileReader;c.onload=async function(){console.log(c.result),o=await async function(e,t){try{const o=n.getDocument({data:e}),r=await o.promise;console.log("PDF loaded");const a=await r.getPage(1);console.log("Page loaded");const s=1.5,l=a.getViewport({scale:s}),c=document.createElement("canvas"),p=c.getContext("2d");c.height=l.height,c.width=l.width;const g={canvasContext:p,viewport:l};return await a.render(g).promise,console.log("Page rendered"),await i(c,t)}catch(e){throw console.error("Error processing PDF:",e),e}}(c.result,l),console.log("OCR Result:",o),a(o)},c.readAsBinaryString(t)}l.close()}return e.ui.registry.addButton("pdfimport",{text:"Import PDF",onAction:function(){s(e)}}),e.ui.registry.addMenuItem("pdfimport",{text:"Import PDF",onAction:function(){s(e)}}),{getMetadata:function(){return{name:"Open from Computer",url:"http://yoursite.com"}}}}));