tinymce.PluginManager.add("pdfImport",(function(t,e){var n=window["pdfjs-dist/build/pdf"],a=tinymce.util.Tools.resolve("tinymce.util.Tools");async function i(t,e,n){try{const a=await Tesseract.createWorker(e,1,{logger:t=>{if("recognizing text"===t.status){const e=Math.round(100*t.progress);n&&n.redial({title:"Scanning PDF with Tesseract OCR...",body:{type:"panel",items:[{type:"htmlpanel",html:`\n\t\t\t\t                                    <div style="padding: 10px;">\n\t\t\t\t                                        <label for="ocr-progress">OCR Progress: ${e}%</label>\n\t\t\t\t                                        <progress id="ocr-progress" max="100" value="${e}" style="width: 100%; height: 20px;"></progress>\n\t\t\t\t                                    </div>\n\t\t\t\t\t\t\t\t\t\t\t`}]},buttons:[]})}}}),i=await a.recognize(t);return await a.terminate(),i.data.text}catch(t){throw console.error("OCR Error:",t),t}}async function r(e,a){try{const s={title:"Loading PDF...",body:{type:"panel",items:[{type:"htmlpanel",html:"\n                            <p>Loading PDF in progress</p>\n                        "}]},buttons:[]};var r=t.windowManager.open(s);const l=n.getDocument({data:e}),p=await l.promise,c=p.numPages;var o="";for(let t=1;t<c+1;t++){const e=await p.getPage(t),n=Math.round(t/c*100);r.redial({title:"Scanning PDF with Tesseract OCR...",body:{type:"panel",items:[{type:"htmlpanel",html:`\n\t\t\t\t\t\t            <div style="padding: 10px;">\n\t\t\t\t\t\t                <label for="file-progress">File progress: ${n}%</label>\n\t\t\t\t\t\t                <progress id="file-progress" max="100" value="${n}" style="width: 100%; height: 20px;"></progress>\n\t\t\t\t\t\t                <p>Processing page ${t} of ${c}</p>\n\t\t\t\t\t\t            </div>\n\t\t                    `}]},buttons:[]});const s=1.5,l=e.getViewport({scale:s}),g=document.createElement("canvas"),u=g.getContext("2d");g.height=l.height,g.width=l.width;const d={canvasContext:u,viewport:l};await e.render(d).promise,o+=await i(g,a)}return r.close(),o}catch(t){throw console.error("Error processing PDF:",t),t}}t.ui.registry.addButton("pdfimport",{text:"OCR",icon:"importpdf",onAction:function(){p(t)}}),t.ui.registry.addMenuItem("pdfimport",{text:"OCR",icon:"importpdf",onAction:function(){p(t)}});var o=function(t){var e=t.getParam("language","en-US");return t.getParam("ocr_language",e)},s=function(t,e){var n=[];return a.each(e,(function(t){n.push({text:t.name,value:t.value})})),n},l=function(t){return a.map(function(t){return t.getParam("ocr_languages","English=en,Danish=da,Dutch=nl,Finnish=fi,French=fr_FR,German=de,Italian=it,Polish=pl,Portuguese=pt_BR,Spanish=es,Swedish=sv")}(t).split(","),(function(t){var e=t.split("=");return{name:e[0],value:e[1]}}))};async function p(t){var e="",n=o(t);const a={title:"Select a file",size:"normal",body:{type:"panel",items:[{type:"selectbox",name:"language",label:"File Language",items:s("Language",l(t))},{type:"urlinput",name:"file",label:"Choose File",filetype:"file"}]},initialData:{language:n},buttons:[{type:"cancel",text:"Cancel"},{type:"submit",text:"Confirm",primary:!0}],onSubmit:async function(t){const n=t.getData();processedFileData&&(-1!==processedFileData.type.indexOf("image")&&(e=await i(processedFileData.file,n.language,p)),-1!==processedFileData.type.indexOf("pdf")&&(e=await r(processedFileData.content,n.language)),e&&window.reapplyPageView(e),processedFileData=null),t.close()}};var p=t.windowManager.open(a)}return{getMetadata:function(){return{name:"Open from Computer",url:"http://yoursite.com"}}}}));