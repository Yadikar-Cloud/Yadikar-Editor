tinymce.PluginManager.add("pdfImport",(function(t,e){let n=null;var r=window["pdfjs-dist/build/pdf"];async function i(){try{if(!window.showOpenFilePicker)return void t.notificationManager.open({text:"File System Access API is not supported in your browser. Please use Chrome, Edge, or Opera.",type:"error",timeout:5e3});const e={types:[{description:"PDF file",accept:{"application/pdf":[".pdf"]}},{description:"PNG file",accept:{"image/png":[".png"]}},{description:"JPEG file",accept:{"image/jpeg":[".jpeg"]}},{description:"WebP file",accept:{"image/webp":[".webp"]}},{description:"TIFF file",accept:{"image/tiff":[".tiff"]}}],multiple:!1,excludeAcceptAllOption:!0};return[n]=await window.showOpenFilePicker(e),await n.getFile()}catch(e){"AbortError"!==e.name&&(console.error("Error opening file:",e),t.notificationManager.open({text:"Failed to open file: "+e.message,type:"error",timeout:5e3}))}}async function o(t,e){try{const n=await Tesseract.createWorker("eng",1,{logger:t=>{if("recognizing text"===t.status){const n=Math.round(100*t.progress);e&&e.redial({title:"Scanning PDF with Tesseract OCR...",body:{type:"panel",items:[{type:"htmlpanel",html:`\n\t\t\t\t                                    <div style="padding: 10px;">\n\t\t\t\t                                        <label for="ocr-progress">OCR Progress: ${n}%</label>\n\t\t\t\t                                        <progress id="ocr-progress" max="100" value="${n}" style="width: 100%; height: 20px;"></progress>\n\t\t\t\t                                    </div>\n\t\t\t\t\t\t\t\t\t\t\t`}]},buttons:[]})}}}),r=await n.recognize(t);return await n.terminate(),r.data.text}catch(t){throw console.error("OCR Error:",t),t}}async function a(e){try{const a={title:"Loading PDF...",body:{type:"panel",items:[{type:"htmlpanel",html:"\n                            <p>Loading PDF in progress</p>\n                        "}]},buttons:[]};var n=t.windowManager.open(a);const s=r.getDocument({data:e}),p=await s.promise,l=p.numPages;var i="";for(let t=1;t<l+1;t++){const e=await p.getPage(t),r=Math.round(t/l*100);n.redial({title:"Scanning PDF with Tesseract OCR...",body:{type:"panel",items:[{type:"htmlpanel",html:`\n\t\t\t\t\t\t            <div style="padding: 10px;">\n\t\t\t\t\t\t                <label for="file-progress">File progress: ${r}%</label>\n\t\t\t\t\t\t                <progress id="file-progress" max="100" value="${r}" style="width: 100%; height: 20px;"></progress>\n\t\t\t\t\t\t                <p>Processing page ${t} of ${l}</p>\n\t\t\t\t\t\t            </div>\n\t\t                    `}]},buttons:[]});const a=1.5,s=e.getViewport({scale:a}),c=document.createElement("canvas"),d=c.getContext("2d");c.height=s.height,c.width=s.width;const g={canvasContext:d,viewport:s};await e.render(g).promise,i+=await o(c)}return n.close(),i}catch(t){throw console.error("Error processing PDF:",t),t}}async function s(t){var e=await i(),n="";const r={title:"Importing PDF...",size:"small",body:{type:"panel",items:[{type:"htmlpanel",html:'\n\t\t\t\t\t\t\t\t\t\t\t<label for="file">File progress:</label>\n\t\t\t\t\t\t\t\t\t\t\t<progress id="file" max="100" value="70">70%</progress>\t                \n\t\t                '}]},buttons:[]};var s=t.windowManager.open(r);if(-1!==e.type.indexOf("image")&&(n=await o(e,s),t.execCommand("pasteText",n)),-1!==e.type.indexOf("pdf")){var p=new FileReader;p.onload=async function(){n=await a(p.result),t.execCommand("pasteText",n)},p.readAsBinaryString(e)}s.close()}return t.ui.registry.addButton("pdfimport",{text:"Import PDF",icon:"export-pdf",onAction:function(){s(t)}}),t.ui.registry.addMenuItem("pdfimport",{text:"Import PDF",icon:"export-pdf",onAction:function(){s(t)}}),{getMetadata:function(){return{name:"Open from Computer",url:"http://yoursite.com"}}}}));