tinymce.PluginManager.add("savetocomputer",(function(e,t){async function o(){try{if(!window.showSaveFilePicker)return void async function(){const t=e.getContent();let o;try{o=await window.fileConverter.convert(t,".html")}catch(t){return void e.notificationManager.open({text:"Conversion failed: "+t.message,type:"error",timeout:5e3})}const n=new Blob([o],{type:"text/html"}),i=URL.createObjectURL(n),a=document.createElement("a");a.href=i,a.download="document.html",document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(i),e.notificationManager.open({text:"File downloaded",type:"success",timeout:3e3})}();const t={suggestedName:"document.html",types:window.getFilePickerTypes(),excludeAcceptAllOption:!0},o=await window.showSaveFilePicker(t),n=await o.createWritable(),i=o.name,a=i.substring(i.lastIndexOf(".")),r=e.getContent();let c;try{c=await window.fileConverter.convert(r,a)}catch(t){return void e.notificationManager.open({text:"Conversion failed: "+t.message,type:"error",timeout:5e3})}Blob,await n.write(c),await n.close(),window.currentLocalFile={handle:o,name:o.name},e.notificationManager.open({text:"Saved: "+o.name,type:"success",timeout:3e3})}catch(t){"AbortError"!==t.name&&(console.error("Error saving file:",t),e.notificationManager.open({text:"Failed to save file: "+t.message,type:"error",timeout:5e3}))}}return e.ui.registry.addButton("savetocomputer",{text:"Save File",onAction:function(){o()}}),e.ui.registry.addMenuItem("savetocomputer",{text:"Local Device",onAction:function(){o()}}),e.ui.registry.addMenuItem("sharefile",{text:"Share",icon:"export",onAction:function(){!async function(){if(navigator.canShare){const t=e.getContent();let o;try{o=await window.fileConverter.convert(t,".html")}catch(t){return void e.notificationManager.open({text:"Conversion failed: "+t.message,type:"error",timeout:5e3})}const n=new Blob([o],{type:"text/html"}),i=new File([n],"document.html",{type:"text/html",lastModified:(new Date).getTime()});try{await navigator.share({title:"My Shared File",text:"Check out this document!",files:[i]}),console.log("File shared successfully")}catch(e){console.error("Share failed:",e.message)}}else e.notificationManager.open({text:"File sharing not supported in your browser!",type:"error",timeout:5e3})}()}}),{getMetadata:function(){return{name:"Save to Computer",url:"http://yoursite.com"}}}}));