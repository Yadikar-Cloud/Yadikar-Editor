tinymce.PluginManager.add("savetocomputer",(function(e,t){async function n(){try{if(!window.showSaveFilePicker)return void async function(){const t=e.getContent();let n;try{n=await window.fileConverter.convert(t,".html")}catch(t){return void e.notificationManager.open({text:"Conversion failed: "+t.message,type:"error",timeout:5e3})}const o=new Blob([n],{type:"text/html"}),i=URL.createObjectURL(o),a=document.createElement("a");a.href=i,a.download="document.html",document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(i),e.notificationManager.open({text:"File downloaded",type:"success",timeout:3e3})}();const t={suggestedName:"document.html",types:window.getFilePickerTypes(),excludeAcceptAllOption:!0};window.fileHandle||(window.fileHandle=await window.showSaveFilePicker(t));const n=await window.fileHandle.createWritable(),o=window.fileHandle.name,i=o.substring(o.lastIndexOf(".")),a=e.getContent();let r;try{r=await window.fileConverter.convert(a,i)}catch(t){return void e.notificationManager.open({text:"Conversion failed: "+t.message,type:"error",timeout:5e3})}Blob,await n.write(r),await n.close(),window.currentLocalFile={handle:window.fileHandle,name:window.fileHandle.name},e.notificationManager.open({text:"Saved: "+window.fileHandle.name,type:"success",timeout:3e3})}catch(t){"AbortError"!==t.name&&(console.error("Error saving file:",t),e.notificationManager.open({text:"Failed to save file: "+t.message,type:"error",timeout:5e3}))}}return e.ui.registry.addButton("savetocomputer",{text:"Save File",onAction:function(){n()}}),e.ui.registry.addMenuItem("savetocomputer",{text:"Local Device",onAction:function(){n()}}),e.ui.registry.addMenuItem("sharefile",{text:"Share",icon:"export",onAction:function(){!async function(){if(navigator.canShare){const t=e.getContent();let n;try{n=await window.fileConverter.convert(t,".html")}catch(t){return void e.notificationManager.open({text:"Conversion failed: "+t.message,type:"error",timeout:5e3})}const o=new Blob([n],{type:"text/html"}),i=new File([o],"document.html",{type:"text/html",lastModified:(new Date).getTime()});try{await navigator.share({title:"My Shared File",text:"Check out this document!",files:[i]}),console.log("File shared successfully")}catch(e){console.error("Share failed:",e.message)}}else e.notificationManager.open({text:"File sharing not supported in your browser!",type:"error",timeout:5e3})}()}}),e.on("init",(function(){e.saveFile=n})),{getMetadata:function(){return{name:"Save to Computer",url:"http://yoursite.com"}}}}));