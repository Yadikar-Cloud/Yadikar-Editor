tinymce.PluginManager.add("savetocomputer",(function(e,t){async function o(){try{if(!window.showSaveFilePicker)return void function(){const t=e.getContent()+"\n",o="<script>const filePath = window.location.href;window.location = '"+window.location.origin+"/editor?q=openfile&file=' + encodeURIComponent(filePath)<\/script>",n=t+o,i=new Blob([n],{type:"text/html"}),a=URL.createObjectURL(i),c=document.createElement("a");c.href=a,c.download="document.html",document.body.appendChild(c),c.click(),document.body.removeChild(c),URL.revokeObjectURL(a),e.notificationManager.open({text:"File downloaded",type:"success",timeout:3e3})}();const t={suggestedName:"document.html",types:window.getFilePickerTypes(),excludeAcceptAllOption:!0},o=await window.showSaveFilePicker(t),n=await o.createWritable(),i=o.name,a=i.substring(i.lastIndexOf(".")),c=e.getContent()+"\n",r=c+("<script>const filePath = window.location.href;window.location = '"+window.location.origin+"/editor?q=openfile&file=' + encodeURIComponent(filePath)<\/script>");let l;try{l=await window.fileConverter.convert(r,a)}catch(t){return void e.notificationManager.open({text:"Conversion failed: "+t.message,type:"error",timeout:5e3})}Blob,await n.write(l),await n.close(),window.currentLocalFile={handle:o,name:o.name},e.notificationManager.open({text:"Saved: "+o.name,type:"success",timeout:3e3})}catch(t){"AbortError"!==t.name&&(console.error("Error saving file:",t),e.notificationManager.open({text:"Failed to save file: "+t.message,type:"error",timeout:5e3}))}}return e.ui.registry.addButton("savetocomputer",{text:"Save File",onAction:function(){o()}}),e.ui.registry.addMenuItem("savetocomputer",{text:"Local Device",onAction:function(){o()}}),e.ui.registry.addMenuItem("sharefile",{text:"Share the document",icon:"export",onAction:function(){!async function(){if(navigator.canShare){const t=e.getContent()+"\n",o="<script>const filePath = window.location.href;window.location = '"+window.location.origin+"/editor?q=openfile&file=' + encodeURIComponent(filePath)<\/script>",n=new Blob([t+o],{type:"text/html"}),i=new File([n],"document.html",{type:"text/html",lastModified:(new Date).getTime()});try{await navigator.share({title:"My Shared File",text:"Check out this document!",files:[i]}),console.log("File shared successfully")}catch(e){console.error("Share failed:",e.message)}}else console.log("File sharing not supported")}()}}),{getMetadata:function(){return{name:"Save to Computer",url:"http://yoursite.com"}}}}));