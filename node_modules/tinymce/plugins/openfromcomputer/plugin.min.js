tinymce.PluginManager.add("openfromcomputer",(function(e,t){let o=null;function n(e){const t=e.toLowerCase();return t.includes("/downloads")?"downloads":t.includes("/desktop")?"desktop":(t.includes("/documents"),"documents")}async function i(t){try{if(!window.showOpenFilePicker)return void e.notificationManager.open({text:"File System Access API is not supported in your browser. Please use Chrome, Edge, or Opera.",type:"error",timeout:5e3});const i={types:[{description:"HTML file",accept:{"text/html":[".html",".htm"]}},{description:"Text file",accept:{"text/plain":[".txt"]}},{description:"Markdown file",accept:{"text/markdown":[".md"]}},{description:"Word Document",accept:{"application/vnd.openxmlformats-officedocument.wordprocessingml.document":[".docx"]}}],startIn:n(t),multiple:!1,excludeAcceptAllOption:!0};[o]=await window.showOpenFilePicker(i);const r=await o.getFile(),a=r.name.substring(r.name.lastIndexOf(".")).toLowerCase();let c;if(".html"===a){const t=await r.text(),o=(new DOMParser).parseFromString(t,"text/html");o.querySelectorAll("script").forEach((e=>e.remove())),e.setContent(o.body.innerHTML)}else{if(".docx"===a)c=await window.fileConverter.convertToHtml(r,a);else{const e=await r.text();c=await window.fileConverter.convertToHtml(e,a)}setTimeout((()=>{window.reapplyPageView&&window.reapplyPageView(c)}),100)}window.currentLocalFile={handle:o,name:r.name,originalExtension:a}}catch(t){"AbortError"!==t.name&&(console.error("Error opening file:",t),e.notificationManager.open({text:"Failed to open file: "+t.message,type:"error",timeout:5e3}))}}return e.ui.registry.addButton("openfromcomputer",{text:"Open File",onAction:function(){i()}}),e.ui.registry.addMenuItem("openfromcomputer",{text:"Local Device",onAction:function(){i()}}),e.addCommand("cmdOpenFile",(function(t,o){!async function(e,t){const o={title:"File Access Notification",body:{type:"panel",items:[{type:"htmlpanel",html:"<p>Select the file again to open with the Yadikar Editor.</p>"}]},buttons:[{type:"cancel",text:"No"},{type:"submit",text:"OK",primary:!0}],onSubmit:async function(e){await i(t),e.close()}};e.windowManager.open(o)}(e,o)})),{getMetadata:function(){return{name:"Open from Computer",url:"http://yoursite.com"}}}}));