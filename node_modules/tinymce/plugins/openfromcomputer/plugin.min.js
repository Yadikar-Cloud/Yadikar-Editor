tinymce.PluginManager.add("openfromcomputer",(function(e,t){async function n(t){try{if(!window.showOpenFilePicker)return void e.notificationManager.open({text:"File System Access API is not supported in your browser. Please use Chrome, Edge, or Opera.",type:"error",timeout:5e3});const t={types:[{description:"HTML file",accept:{"text/html":[".html",".htm"]}},{description:"Text file",accept:{"text/plain":[".txt"]}},{description:"Markdown file",accept:{"text/markdown":[".md"]}},{description:"Word Document",accept:{"application/vnd.openxmlformats-officedocument.wordprocessingml.document":[".docx"]}}],multiple:!1,excludeAcceptAllOption:!0};[fileHandle]=await window.showOpenFilePicker(t);await fileHandle.createWritable();const n=await fileHandle.getFile(),o=n.name.substring(n.name.lastIndexOf(".")).toLowerCase();let i;if(".html"===o){const t=await n.text(),o=(new DOMParser).parseFromString(t,"text/html");o.querySelectorAll("script").forEach((e=>e.remove())),e.setContent(o.body.innerHTML)}else{if(".docx"===o)i=await window.fileConverter.convertToHtml(n,o);else{const e=await n.text();i=await window.fileConverter.convertToHtml(e,o)}setTimeout((()=>{window.reapplyPageView&&window.reapplyPageView(i)}),100)}window.currentLocalFile={handle:fileHandle,name:n.name,originalExtension:o}}catch(t){"AbortError"!==t.name&&(console.error("Error opening file:",t),e.notificationManager.open({text:"Failed to open file: "+t.message,type:"error",timeout:5e3}))}}return window.fileHandle=null,e.ui.registry.addButton("openfromcomputer",{text:"Open File",onAction:function(){n()}}),e.ui.registry.addMenuItem("openfromcomputer",{text:"Local Device",onAction:function(){n()}}),e.addCommand("cmdOpenFile",(function(t,o){!async function(e){const t={title:"File Access Notification",body:{type:"panel",items:[{type:"htmlpanel",html:"<p>Select the file again to open with the Yadikar Editor.</p>"}]},buttons:[{type:"cancel",text:"No"},{type:"submit",text:"OK",primary:!0}],onSubmit:async function(e){await n(),e.close()}};e.windowManager.open(t)}(e)})),{getMetadata:function(){return{name:"Open from Computer",url:"http://yoursite.com"}}}}));