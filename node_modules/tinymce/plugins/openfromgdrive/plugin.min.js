tinymce.PluginManager.add("openfromgdrive",function(e,o){let t=!1;function n(){setTimeout(()=>{e.focus(),e.fire("focus")},0)}async function i(){t||(window.cloudProviders&&window.cloudProviders.google&&window.cloudProviders.google.authenticated?function(o){if("undefined"==typeof gapi)return void e.notificationManager.open({text:"Google API is loading... Please try again.",type:"info",timeout:2e3});if(!gapi.client||!gapi.client.setToken)return void e.notificationManager.open({text:"Google API not ready. Please wait and try again.",type:"info",timeout:2e3});gapi.client.setToken({access_token:o.token}),gapi.load("picker",function(){t=!0;(new google.picker.PickerBuilder).addView(google.picker.ViewId.DOCS).setOAuthToken(o.token).setDeveloperKey(o.apiKey).setCallback(a).setTitle("Open from Google Drive").build().setVisible(!0)})}(window.cloudProviders.google):function(){const o={title:"Sign In Required",size:"normal",body:{type:"panel",items:[{type:"htmlpanel",html:'\n                            <div style="text-align: center; padding: 40px 20px;">\n                                <div style="font-size: 64px; margin-bottom: 20px;">üìÅ</div>\n                                <h3 style="margin-bottom: 10px; color: #333;">Sign in to Google Drive</h3>\n                                <p style="color: #666; margin-bottom: 30px;">\n                                    You need to sign in with your Google account to access your Drive files.\n                                </p>\n                            </div>\n                        '}]},buttons:[{type:"cancel",text:"Cancel"},{type:"custom",text:"Sign In with Google",name:"signin",primary:!0}],onAction:function(o,t){"signin"===t.name&&(o.close(),function(){const o=600,t=700,n=(screen.width-o)/2,i=(screen.height-t)/2;window.open("/auth/google","GoogleAuth",`width=${o},height=${t},left=${n},top=${i},toolbar=no,location=no,status=no,menubar=no,scrollbars=yes,resizable=yes`)||e.notificationManager.open({text:"Popup blocked! Please allow popups for this site.",type:"error",timeout:5e3})}())}};e.windowManager.open(o)}())}function a(o){if(o.action===google.picker.Action.PICKED){const t=o.docs[0];!async function(o,t){e.notificationManager.open({text:"Loading file...",type:"info"});try{const n=await gapi.client.drive.files.get({fileId:o,alt:"media"});e.setContent(n.body),window.currentGDriveFile={id:o,name:t},e.notificationManager.open({text:"Opened: "+t,type:"success",timeout:3e3})}catch(o){console.error("Error loading file:",o),e.notificationManager.open({text:"Failed to open file: "+o.message,type:"error",timeout:5e3})}}(t.id,t.name),n()}else o.action===google.picker.Action.CANCEL&&(e.notificationManager.open({text:"Selection cancelled",type:"info",timeout:2e3}),n());t=!1}return e.ui.registry.addButton("openfromgdrive",{text:"Open from Drive",onAction:function(){i()}}),e.ui.registry.addMenuItem("openfromgdrive",{text:"Google Drive",onAction:function(){i()}}),{getMetadata:function(){return{name:"Open from Google Drive",url:"http://yoursite.com"}}}});