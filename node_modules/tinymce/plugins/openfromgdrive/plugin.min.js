tinymce.PluginManager.add("openfromgdrive",function(e,o){let i=!1;function t(){setTimeout(()=>{e.focus(),e.fire("focus")},0)}async function n(){if(i)return;let o=null;o=window.cloudProviders&&window.cloudProviders.google?window.cloudProviders.google:await window.requireCloudAuth("google"),o&&function(o){if("undefined"==typeof gapi)return void e.notificationManager.open({text:"Google API is loading... Please try again.",type:"info",timeout:2e3});if(!gapi.client||!gapi.client.setToken)return void e.notificationManager.open({text:"Google API not ready. Please wait and try again.",type:"info",timeout:2e3});gapi.client.setToken({access_token:o.token}),gapi.load("picker",function(){i=!0;(new google.picker.PickerBuilder).addView(google.picker.ViewId.DOCS).setOAuthToken(o.token).setDeveloperKey(o.apiKey).setCallback(r).setTitle("Open from Google Drive").build().setVisible(!0)})}(o)}function r(o){if(o.action===google.picker.Action.PICKED){const i=o.docs[0];!async function(o,i){e.notificationManager.open({text:"Loading file...",type:"info"});try{const t=await gapi.client.drive.files.get({fileId:o,alt:"media"});e.setContent(t.body),window.currentGDriveFile={id:o,name:i},e.notificationManager.open({text:"Opened: "+i,type:"success",timeout:3e3})}catch(o){console.error("Error loading file:",o),e.notificationManager.open({text:"Failed to open file: "+o.message,type:"error",timeout:5e3})}}(i.id,i.name),t()}else o.action===google.picker.Action.CANCEL&&(e.notificationManager.open({text:"Selection cancelled",type:"info",timeout:2e3}),t());i=!1}return e.ui.registry.addButton("openfromgdrive",{text:"Open from Drive",onAction:function(){n()}}),e.ui.registry.addMenuItem("openfromgdrive",{text:"Google Drive",onAction:function(){n()}}),{getMetadata:function(){return{name:"Open from Google Drive",url:"http://yoursite.com"}}}});